
use_flake() {
  watch_file flake.nix
  watch_file flake.lock
  eval "$(nixFlakes print-dev-env --profile "$(direnv_layout_dir)/flake-profile")"
}

if has nixFlakes; then
  use flake
elif has nix; then
  use nix

  watch_file nix/default.nix nix/sources.nix nix/sources.json
fi
